#!/usr/bin/env bash

config-init-scd() {
  path=${SCD_CONFIG:-$1}
  if [[ ! -e "$path" ]]; then
    echo "Config file not found: $path not found"
    exit 1
  fi
  exports=$(cat $path | jq -r ".deploy_data // . | \
    to_entries|map(\"\(.key)=\(.value|tostring)\")|.[]")
  for e in $exports; do export "$e"; done
}

config-init-mcd() {
  path=${MCD_CONFIG:-$1}
  if [[ ! -e "$path" ]]; then
    echo "Config file not found: $path not found"
    exit 1
  fi
  exports=$(cat $path | jq -r ".deploy_data // . | \
    to_entries|map(\"\(.key)=\(.value|tostring)\")|.[]")
  for e in $exports; do export "$e"; done
}

config-init-colt() {
  path=${COLT_CONFIG:-$1}
  if [[ ! -e "$path" ]]; then
    echo "Config file not found: $path not found"
    exit 1
  fi
  echo ${COLT_CONFIG}
  exports=$(cat $path | jq -r ".deploy_data // . | \
    to_entries|map(\"\(.key)=\(.value|tostring)\")|.[]")
  for e in $exports; do export "$e"; done
}

config-init-scd
config-init-mcd
config-init-colt

ilk=$NAME
# TODO need to set PIP_USDT from deploy-spell
seth send $PIP_USDT 'poke(bytes32)' $(seth --to-uint256 1)

seth send $MCD_SPOT 'poke(bytes32)' "$ilk"